<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1041px" preserveAspectRatio="none" style="width:2217px;height:1041px;" version="1.1" viewBox="0 0 2217 1041" width="2217px" zoomAndPan="magnify"><defs><filter height="300%" id="ftquf03cwy3xp" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="381" x="913.75" y="26.708">Startup, Refill request, and Migration flows</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="50" x2="50" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="375" x2="375" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="583.5" x2="583.5" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="714.5" x2="714.5" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="888.5" x2="888.5" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058.5" x2="1058.5" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1419" x2="1419" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1587" x2="1587" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1804" x2="1804" y1="121.25" y2="953.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2177.5" x2="2177.5" y1="121.25" y2="953.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="8" y="117.9482">Dev / Client</text><ellipse cx="50.5" cy="47.9531" fill="#FEFECE" filter="url(#ftquf03cwy3xp)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M50.5,55.9531 L50.5,82.9531 M37.5,63.9531 L63.5,63.9531 M50.5,82.9531 L37.5,97.9531 M50.5,82.9531 L63.5,97.9531 " fill="none" filter="url(#ftquf03cwy3xp)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="8" y="965.6982">Dev / Client</text><ellipse cx="50.5" cy="979" fill="#FEFECE" filter="url(#ftquf03cwy3xp)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M50.5,987 L50.5,1014 M37.5,995 L63.5,995 M50.5,1014 L37.5,1029 M50.5,1014 L63.5,1029 " fill="none" filter="url(#ftquf03cwy3xp)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="319" y="69.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="347.5" y="89.6514">index.js</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="326" y="105.9482">(Express app)</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="319" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="347.5" y="972.6982">index.js</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="326" y="988.9951">(Express app)</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="530.5" y="69.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="541.5" y="89.6514">config/db.js</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="537.5" y="105.9482">(connectDB)</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="530.5" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="541.5" y="972.6982">config/db.js</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="537.5" y="988.9951">(connectDB)</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="646.5" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="653.5" y="105.9482">routes/refillRoute</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="646.5" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="653.5" y="972.6982">routes/refillRoute</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="186" x="793.5" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="172" x="800.5" y="105.9482">controllers/refillController</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="186" x="793.5" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="172" x="800.5" y="972.6982">controllers/refillController</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="993.5" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1000.5" y="105.9482">models/RefillLog</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="993.5" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1000.5" y="972.6982">models/RefillLog</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="1355" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="1362" y="105.9482">models/Product</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="1355" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="1362" y="972.6982">models/Product</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="1493" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="171" x="1500" y="105.9482">models/VendingMachine</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="1493" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="171" x="1500" y="972.6982">models/VendingMachine</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="220" x="1692" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="206" x="1699" y="105.9482">scripts/migrateRefillSchema.js</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="220" x="1692" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="206" x="1699" y="972.6982">scripts/migrateRefillSchema.js</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="2155.5" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="2162.5" y="105.9482">Dev</text><rect fill="#FEFECE" filter="url(#ftquf03cwy3xp)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="2155.5" y="952.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="2162.5" y="972.6982">Dev</text><rect fill="#EEEEEE" filter="url(#ftquf03cwy3xp)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2202.5" x="3" y="151.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2205.5" y1="151.8164" y2="151.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2205.5" y1="154.8164" y2="154.8164"/><rect fill="#EEEEEE" filter="url(#ftquf03cwy3xp)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="74" x="1067.25" y="141.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="55" x="1073.25" y="157.3169">Startup</text><polygon fill="#A80036" points="363.5,191.5156,373.5,195.5156,363.5,199.5156,367.5,195.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="369.5" y1="195.5156" y2="195.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="57.5" y="190.4497">start node index.js</text><polygon fill="#A80036" points="571.5,220.6484,581.5,224.6484,571.5,228.6484,575.5,224.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="577.5" y1="224.6484" y2="224.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="382.5" y="219.5825">dotenv.config(); connectDB()</text><polygon fill="#A80036" points="386.5,249.7813,376.5,253.7813,386.5,257.7813,382.5,253.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="380.5" x2="582.5" y1="253.7813" y2="253.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="392.5" y="248.7153">mongoose connected</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="417.5" y1="282.9141" y2="282.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="417.5" x2="417.5" y1="282.9141" y2="295.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376.5" x2="417.5" y1="295.9141" y2="295.9141"/><polygon fill="#A80036" points="386.5,291.9141,376.5,295.9141,386.5,299.9141,382.5,295.9141" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="382.5" y="277.8481">mount routes, start listening</text><rect fill="#EEEEEE" filter="url(#ftquf03cwy3xp)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2202.5" x="3" y="324.4805"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2205.5" y1="324.4805" y2="324.4805"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2205.5" y1="327.4805" y2="327.4805"/><rect fill="#EEEEEE" filter="url(#ftquf03cwy3xp)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="252" x="978.25" y="313.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="233" x="984.25" y="329.981">Refill request (POST /api/refills)</text><polygon fill="#A80036" points="363.5,364.1797,373.5,368.1797,363.5,372.1797,367.5,368.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="369.5" y1="368.1797" y2="368.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="301" x="57.5" y="363.1138">POST /api/refills { machine, refilledBy, items[] }</text><polygon fill="#A80036" points="703,393.3125,713,397.3125,703,401.3125,707,397.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="709" y1="397.3125" y2="397.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="382.5" y="392.2466">route handler</text><polygon fill="#A80036" points="876.5,422.4453,886.5,426.4453,876.5,430.4453,880.5,426.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="715" x2="882.5" y1="426.4453" y2="426.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="722" y="421.3794">createRefill(body)</text><polygon fill="#A80036" points="1575.5,451.5781,1585.5,455.5781,1575.5,459.5781,1579.5,455.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="888.5" x2="1581.5" y1="455.5781" y2="455.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="895.5" y="450.5122">findById(machine)</text><polygon fill="#A80036" points="899.5,480.7109,889.5,484.7109,899.5,488.7109,895.5,484.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="893.5" x2="1586.5" y1="484.7109" y2="484.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="905.5" y="479.645">vendingMachine doc</text><polygon fill="#A80036" points="1047,509.8438,1057,513.8438,1047,517.8438,1051,513.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="888.5" x2="1053" y1="513.8438" y2="513.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="895.5" y="508.7778">create(log per item)</text><polygon fill="#A80036" points="1407,538.9766,1417,542.9766,1407,546.9766,1411,542.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1059" x2="1413" y1="542.9766" y2="542.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="336" x="1066" y="537.9106">post-save hook -&gt; findByIdAndUpdate($inc quantity)</text><polygon fill="#A80036" points="1575.5,568.1094,1585.5,572.1094,1575.5,576.1094,1579.5,572.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="888.5" x2="1581.5" y1="572.1094" y2="572.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="895.5" y="567.0435">update stock (push or increment slot)</text><polygon fill="#A80036" points="899.5,597.2422,889.5,601.2422,899.5,605.2422,895.5,601.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="893.5" x2="1586.5" y1="601.2422" y2="601.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="905.5" y="596.1763">saved vendingMachine</text><polygon fill="#A80036" points="386.5,626.375,376.5,630.375,386.5,634.375,382.5,630.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="380.5" x2="887.5" y1="630.375" y2="630.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="392.5" y="625.3091">res.status(201).json({createdLogs})</text><polygon fill="#A80036" points="61.5,655.5078,51.5,659.5078,61.5,663.5078,57.5,659.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="55.5" x2="374.5" y1="659.5078" y2="659.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="67.5" y="654.4419">201 Created</text><rect fill="#EEEEEE" filter="url(#ftquf03cwy3xp)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2202.5" x="3" y="688.0742"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2205.5" y1="688.0742" y2="688.0742"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2205.5" y1="691.0742" y2="691.0742"/><rect fill="#EEEEEE" filter="url(#ftquf03cwy3xp)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="331" x="938.75" y="677.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="312" x="944.75" y="693.5747">Migration (scripts/migrateRefillSchema.js)</text><polygon fill="#A80036" points="1815,727.7734,1805,731.7734,1815,735.7734,1811,731.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1809" x2="2177" y1="731.7734" y2="731.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="1821" y="726.7075">node scripts/migrateRefillSchema.js (with MONGO_URI)</text><polygon fill="#A80036" points="594.5,756.9063,584.5,760.9063,594.5,764.9063,590.5,760.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="588.5" x2="1803" y1="760.9063" y2="760.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="600.5" y="755.8403">connectDB()</text><polygon fill="#A80036" points="594.5,786.0391,584.5,790.0391,594.5,794.0391,590.5,790.0391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="588.5" x2="1803" y1="790.0391" y2="790.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="600.5" y="784.9731">listCollections -&gt; find 'refills'</text><polygon fill="#A80036" points="594.5,815.1719,584.5,819.1719,594.5,823.1719,590.5,819.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="588.5" x2="1803" y1="819.1719" y2="819.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="600.5" y="814.106">for each legacy doc:</text><polygon fill="#A80036" points="1070,844.3047,1060,848.3047,1070,852.3047,1066,848.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1064" x2="1803" y1="848.3047" y2="848.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="1076" y="843.2388">create entries</text><polygon fill="#A80036" points="1598.5,873.4375,1588.5,877.4375,1598.5,881.4375,1594.5,877.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1592.5" x2="1803" y1="877.4375" y2="877.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="1604.5" y="872.3716">findById &amp; update stock</text><polygon fill="#A80036" points="594.5,902.5703,584.5,906.5703,594.5,910.5703,590.5,906.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="588.5" x2="1803" y1="906.5703" y2="906.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="600.5" y="901.5044">insert into refills_migrated; delete original</text><polygon fill="#A80036" points="2166,931.7031,2176,935.7031,2166,939.7031,2170,935.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1804" x2="2172" y1="935.7031" y2="935.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1811" y="930.6372">exit(0) on success</text><!--MD5=[3e76f64512ac7e3439afa6e78628929b]
@startuml
title Startup, Refill request, and Migration flows

actor "Dev / Client" as Client
participant "index.js\n(Express app)" as Index
participant "config/db.js\n(connectDB)" as DB
participant "routes/refillRoute" as Route
participant "controllers/refillController" as Controller
participant "models/RefillLog" as RefillLog
participant "models/Product" as Product
participant "models/VendingMachine" as VM
participant "scripts/migrateRefillSchema.js" as Migrator

== Startup ==
Client -> Index: start node index.js
Index -> DB: dotenv.config(); connectDB()
DB - -> Index: mongoose connected
Index -> Index: mount routes, start listening

== Refill request (POST /api/refills) ==
Client -> Index: POST /api/refills { machine, refilledBy, items[] }
Index -> Route: route handler
Route -> Controller: createRefill(body)
Controller -> VM: findById(machine)
VM - -> Controller: vendingMachine doc
Controller -> RefillLog: create(log per item)
RefillLog -> Product: post-save hook -> findByIdAndUpdate($inc quantity)
Controller -> VM: update stock (push or increment slot)
VM - -> Controller: saved vendingMachine
Controller -> Index: res.status(201).json({createdLogs})
Index -> Client: 201 Created

== Migration (scripts/migrateRefillSchema.js) ==
Dev -> Migrator: node scripts/migrateRefillSchema.js (with MONGO_URI)
Migrator -> DB: connectDB()
Migrator -> DB: listCollections -> find 'refills'
Migrator -> DB: for each legacy doc:
Migrator -> RefillLog: create entries
Migrator -> VM: findById & update stock
Migrator -> DB: insert into refills_migrated; delete original
Migrator -> Dev: exit(0) on success

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.7+6-LTS
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>