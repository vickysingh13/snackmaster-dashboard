<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1139px" preserveAspectRatio="none" style="width:1313px;height:1139px;" version="1.1" viewBox="0 0 1313 1139" width="1313px" zoomAndPan="magnify"><defs><filter height="300%" id="f4bhnxjssgq2b" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[027ebfd53c01aea08f474edbf35d0797]
cluster Models--><polygon fill="#FFFFFF" filter="url(#f4bhnxjssgq2b)" points="326,534,388,534,395,556.2969,789,556.2969,789,1127,326,1127,326,534" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="326" x2="395" y1="556.2969" y2="556.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="330" y="548.9951">Models</text><!--MD5=[ed1d20ea533a2a0e7df5ba3c35e56ced]
cluster Controllers--><polygon fill="#FFFFFF" filter="url(#f4bhnxjssgq2b)" points="229,348,323,348,330,370.2969,630,370.2969,630,485,229,485,229,348" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="229" x2="330" y1="370.2969" y2="370.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="233" y="362.9951">Controllers</text><!--MD5=[fe136eabe4a7fd8dd15eb01473fe8855]
cluster Infra--><polygon fill="#FFFFFF" filter="url(#f4bhnxjssgq2b)" points="22,24,64,24,71,46.2969,1187,46.2969,1187,299,22,299,22,24" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="22" x2="71" y1="46.2969" y2="46.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="26" y="38.9951">Infra</text><!--MD5=[898ddfb0345ec8532c0d8d277305d0fa]
class VendingMachine--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="124.8281" id="VendingMachine" style="stroke: #A80036; stroke-width: 1.5;" width="268" x="342" y="784"/><ellipse cx="420.25" cy="800" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M423.2188,805.6406 Q422.6406,805.9375 422,806.0781 Q421.3594,806.2344 420.6563,806.2344 Q418.1563,806.2344 416.8281,804.5938 Q415.5156,802.9375 415.5156,799.8125 Q415.5156,796.6875 416.8281,795.0313 Q418.1563,793.375 420.6563,793.375 Q421.3594,793.375 422,793.5313 Q422.6563,793.6875 423.2188,793.9844 L423.2188,796.7031 Q422.5938,796.125 422,795.8594 Q421.4063,795.5781 420.7813,795.5781 Q419.4375,795.5781 418.75,796.6563 Q418.0625,797.7188 418.0625,799.8125 Q418.0625,801.9063 418.75,802.9844 Q419.4375,804.0469 420.7813,804.0469 Q421.4063,804.0469 422,803.7813 Q422.5938,803.5 423.2188,802.9219 L423.2188,805.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="103" x="440.75" y="804.1543">VendingMachine</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="343" x2="609" y1="816" y2="816"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="350" y="824"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="362" y="830.2104">_id:ObjectId</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="350" y="836.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="114" x="362" y="843.0151">machineCode:string</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="350" y="849.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="81" x="362" y="855.8198">location:string</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="350" y="862.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="362" y="868.6245">totalSlots:int</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="350" y="875.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="242" x="362" y="881.4292">stock: [{ productId:ObjectId, quantity:int }]</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="343" x2="609" y1="888.0234" y2="888.0234"/><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="350" y="896.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="199" x="362" y="902.2339">updateStock(productId, qtyChange)</text><!--MD5=[72136138052d025cffdce3c22fbd185f]
class Product--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="124.8281" id="Product" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="526" y="986"/><ellipse cx="564.85" cy="1002" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M567.8188,1007.6406 Q567.2406,1007.9375 566.6,1008.0781 Q565.9594,1008.2344 565.2563,1008.2344 Q562.7563,1008.2344 561.4281,1006.5938 Q560.1156,1004.9375 560.1156,1001.8125 Q560.1156,998.6875 561.4281,997.0313 Q562.7563,995.375 565.2563,995.375 Q565.9594,995.375 566.6,995.5313 Q567.2563,995.6875 567.8188,995.9844 L567.8188,998.7031 Q567.1938,998.125 566.6,997.8594 Q566.0063,997.5781 565.3813,997.5781 Q564.0375,997.5781 563.35,998.6563 Q562.6625,999.7188 562.6625,1001.8125 Q562.6625,1003.9063 563.35,1004.9844 Q564.0375,1006.0469 565.3813,1006.0469 Q566.0063,1006.0469 566.6,1005.7813 Q567.1938,1005.5 567.8188,1004.9219 L567.8188,1007.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="584.15" y="1006.1543">Product</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="527" x2="659" y1="1018" y2="1018"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="534" y="1026"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="546" y="1032.2104">_id:ObjectId</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="534" y="1038.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="69" x="546" y="1045.0151">name:string</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="534" y="1051.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="86" x="546" y="1057.8198">category:string</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="534" y="1064.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="76" x="546" y="1070.6245">price:number</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="534" y="1077.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="63" x="546" y="1083.4292">quantity:int</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="534" y="1090.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="108" x="546" y="1096.2339">machineId:ObjectId</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="527" x2="659" y1="1102.8281" y2="1102.8281"/><!--MD5=[d013ea7ad23c756d3c057488d91fd435]
class RefillLog--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="137.6328" id="RefillLog" style="stroke: #A80036; stroke-width: 1.5;" width="274" x="438" y="569"/><ellipse cx="545.25" cy="585" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M548.2188,590.6406 Q547.6406,590.9375 547,591.0781 Q546.3594,591.2344 545.6563,591.2344 Q543.1563,591.2344 541.8281,589.5938 Q540.5156,587.9375 540.5156,584.8125 Q540.5156,581.6875 541.8281,580.0313 Q543.1563,578.375 545.6563,578.375 Q546.3594,578.375 547,578.5313 Q547.6563,578.6875 548.2188,578.9844 L548.2188,581.7031 Q547.5938,581.125 547,580.8594 Q546.4063,580.5781 545.7813,580.5781 Q544.4375,580.5781 543.75,581.6563 Q543.0625,582.7188 543.0625,584.8125 Q543.0625,586.9063 543.75,587.9844 Q544.4375,589.0469 545.7813,589.0469 Q546.4063,589.0469 547,588.7813 Q547.5938,588.5 548.2188,587.9219 L548.2188,590.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="51" x="565.75" y="589.1543">RefillLog</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="439" x2="711" y1="601" y2="601"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="446" y="609"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="458" y="615.2104">_id:ObjectId</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="446" y="621.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="103" x="458" y="628.0151">productId:ObjectId</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="446" y="634.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="108" x="458" y="640.8198">machineId:ObjectId</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="446" y="647.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="458" y="653.6245">quantityAdded:int</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="446" y="660.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="458" y="666.4292">refilledBy:string</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="446" y="673.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="85" x="458" y="679.2339">remarks:string</text><ellipse cx="449" cy="688.8281" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="248" x="458" y="692.0386">post-save hook: increment Product.quantity</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="439" x2="711" y1="698.6328" y2="698.6328"/><!--MD5=[5044db128eaad7dfa394e0c943399b0c]
class vendingMachineController--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="86.4141" id="vendingMachineController" style="stroke: #A80036; stroke-width: 1.5;" width="194" x="245" y="383"/><ellipse cx="260" cy="399" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M262.9688,404.6406 Q262.3906,404.9375 261.75,405.0781 Q261.1094,405.2344 260.4063,405.2344 Q257.9063,405.2344 256.5781,403.5938 Q255.2656,401.9375 255.2656,398.8125 Q255.2656,395.6875 256.5781,394.0313 Q257.9063,392.375 260.4063,392.375 Q261.1094,392.375 261.75,392.5313 Q262.4063,392.6875 262.9688,392.9844 L262.9688,395.7031 Q262.3438,395.125 261.75,394.8594 Q261.1563,394.5781 260.5313,394.5781 Q259.1875,394.5781 258.5,395.6563 Q257.8125,396.7188 257.8125,398.8125 Q257.8125,400.9063 258.5,401.9844 Q259.1875,403.0469 260.5313,403.0469 Q261.1563,403.0469 261.75,402.7813 Q262.3438,402.5 262.9688,401.9219 L262.9688,404.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="162" x="274" y="403.1543">vendingMachineController</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="246" x2="438" y1="415" y2="415"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="246" x2="438" y1="423" y2="423"/><ellipse cx="256" cy="434" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="121" x="265" y="437.2104">getMachines(req,res)</text><ellipse cx="256" cy="446.8047" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="138" x="265" y="450.0151">getMachineById(req,res)</text><ellipse cx="256" cy="459.6094" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="132" x="265" y="462.8198">createMachine(req,res)</text><!--MD5=[7c03d0f029a05f4854120c7f05c13941]
class refillController--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="73.6094" id="refillController" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="474.5" y="389"/><ellipse cx="498.5" cy="405" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M501.4688,410.6406 Q500.8906,410.9375 500.25,411.0781 Q499.6094,411.2344 498.9063,411.2344 Q496.4063,411.2344 495.0781,409.5938 Q493.7656,407.9375 493.7656,404.8125 Q493.7656,401.6875 495.0781,400.0313 Q496.4063,398.375 498.9063,398.375 Q499.6094,398.375 500.25,398.5313 Q500.9063,398.6875 501.4688,398.9844 L501.4688,401.7031 Q500.8438,401.125 500.25,400.8594 Q499.6563,400.5781 499.0313,400.5781 Q497.6875,400.5781 497,401.6563 Q496.3125,402.7188 496.3125,404.8125 Q496.3125,406.9063 497,407.9844 Q497.6875,409.0469 499.0313,409.0469 Q499.6563,409.0469 500.25,408.7813 Q500.8438,408.5 501.4688,407.9219 L501.4688,410.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="87" x="514.5" y="409.1543">refillController</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="475.5" x2="612.5" y1="421" y2="421"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="475.5" x2="612.5" y1="429" y2="429"/><ellipse cx="485.5" cy="440" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="102" x="494.5" y="443.2104">getRefills(req,res)</text><ellipse cx="485.5" cy="452.8047" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="113" x="494.5" y="456.0151">createRefill(req,res)</text><!--MD5=[1a56e86ad906f6b2cf92a71e70d23381]
class index_js--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="60.8047" id="index_js" style="stroke: #A80036; stroke-width: 1.5;" width="495" x="38.5" y="59"/><ellipse cx="257.25" cy="75" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M260.2188,80.6406 Q259.6406,80.9375 259,81.0781 Q258.3594,81.2344 257.6563,81.2344 Q255.1563,81.2344 253.8281,79.5938 Q252.5156,77.9375 252.5156,74.8125 Q252.5156,71.6875 253.8281,70.0313 Q255.1563,68.375 257.6563,68.375 Q258.3594,68.375 259,68.5313 Q259.6563,68.6875 260.2188,68.9844 L260.2188,71.7031 Q259.5938,71.125 259,70.8594 Q258.4063,70.5781 257.7813,70.5781 Q256.4375,70.5781 255.75,71.6563 Q255.0625,72.7188 255.0625,74.8125 Q255.0625,76.9063 255.75,77.9844 Q256.4375,79.0469 257.7813,79.0469 Q258.4063,79.0469 259,78.7813 Q259.5938,78.5 260.2188,77.9219 L260.2188,80.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="277.75" y="79.1543">index_js</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="39.5" x2="532.5" y1="91" y2="91"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="39.5" x2="532.5" y1="99" y2="99"/><ellipse cx="49.5" cy="110" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="469" x="58.5" y="113.2104">start(): loads dotenv, connectDB(), express app, mount routes, graceful shutdown</text><!--MD5=[c4c01e3e6a02acb820ae9926bae8db80]
class db_js--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="60.8047" id="db_js" style="stroke: #A80036; stroke-width: 1.5;" width="364" x="63" y="209.5"/><ellipse cx="224.75" cy="225.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M227.7188,231.1406 Q227.1406,231.4375 226.5,231.5781 Q225.8594,231.7344 225.1563,231.7344 Q222.6563,231.7344 221.3281,230.0938 Q220.0156,228.4375 220.0156,225.3125 Q220.0156,222.1875 221.3281,220.5313 Q222.6563,218.875 225.1563,218.875 Q225.8594,218.875 226.5,219.0313 Q227.1563,219.1875 227.7188,219.4844 L227.7188,222.2031 Q227.0938,221.625 226.5,221.3594 Q225.9063,221.0781 225.2813,221.0781 Q223.9375,221.0781 223.25,222.1563 Q222.5625,223.2188 222.5625,225.3125 Q222.5625,227.4063 223.25,228.4844 Q223.9375,229.5469 225.2813,229.5469 Q225.9063,229.5469 226.5,229.2813 Q227.0938,229 227.7188,228.4219 L227.7188,231.1406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="32" x="245.25" y="229.6543">db_js</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="64" x2="426" y1="241.5" y2="241.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="64" x2="426" y1="249.5" y2="249.5"/><ellipse cx="74" cy="260.5" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="338" x="83" y="263.7104">connectDB(): validates MONGO_URI, mongoose.connect(uri)</text><!--MD5=[2e466aa7ff0365bd674f4d8c643a3b22]
class migrateRefillSchema--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="60.8047" id="migrateRefillSchema" style="stroke: #A80036; stroke-width: 1.5;" width="364" x="569" y="59"/><ellipse cx="683.25" cy="75" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686.2188,80.6406 Q685.6406,80.9375 685,81.0781 Q684.3594,81.2344 683.6563,81.2344 Q681.1563,81.2344 679.8281,79.5938 Q678.5156,77.9375 678.5156,74.8125 Q678.5156,71.6875 679.8281,70.0313 Q681.1563,68.375 683.6563,68.375 Q684.3594,68.375 685,68.5313 Q685.6563,68.6875 686.2188,68.9844 L686.2188,71.7031 Q685.5938,71.125 685,70.8594 Q684.4063,70.5781 683.7813,70.5781 Q682.4375,70.5781 681.75,71.6563 Q681.0625,72.7188 681.0625,74.8125 Q681.0625,76.9063 681.75,77.9844 Q682.4375,79.0469 683.7813,79.0469 Q684.4063,79.0469 685,78.7813 Q685.5938,78.5 686.2188,77.9219 L686.2188,80.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="127" x="703.75" y="79.1543">migrateRefillSchema</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="570" x2="932" y1="91" y2="91"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="570" x2="932" y1="99" y2="99"/><ellipse cx="580" cy="110" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="338" x="589" y="113.2104">run(): migrate legacy refills -&gt; RefillLog + update machines</text><!--MD5=[f85978be3df145d2cae149401b1d963f]
class tests--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="60.8047" id="tests" style="stroke: #A80036; stroke-width: 1.5;" width="203" x="968.5" y="59"/><ellipse cx="1049.75" cy="75" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1052.7188,80.6406 Q1052.1406,80.9375 1051.5,81.0781 Q1050.8594,81.2344 1050.1563,81.2344 Q1047.6563,81.2344 1046.3281,79.5938 Q1045.0156,77.9375 1045.0156,74.8125 Q1045.0156,71.6875 1046.3281,70.0313 Q1047.6563,68.375 1050.1563,68.375 Q1050.8594,68.375 1051.5,68.5313 Q1052.1563,68.6875 1052.7188,68.9844 L1052.7188,71.7031 Q1052.0938,71.125 1051.5,70.8594 Q1050.9063,70.5781 1050.2813,70.5781 Q1048.9375,70.5781 1048.25,71.6563 Q1047.5625,72.7188 1047.5625,74.8125 Q1047.5625,76.9063 1048.25,77.9844 Q1048.9375,79.0469 1050.2813,79.0469 Q1050.9063,79.0469 1051.5,78.7813 Q1052.0938,78.5 1052.7188,77.9219 L1052.7188,80.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="32" x="1070.25" y="79.1543">tests</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="969.5" x2="1170.5" y1="91" y2="91"/><ellipse cx="979.5" cy="102" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="177" x="988.5" y="105.2104">uses mongodb-memory-server</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="969.5" x2="1170.5" y1="111.8047" y2="111.8047"/><!--MD5=[4e5e1fd7835748d2130dd04f1359b45f]
class routes--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="86.4141" id="routes" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="462" y="197"/><ellipse cx="511.25" cy="213" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M514.2188,218.6406 Q513.6406,218.9375 513,219.0781 Q512.3594,219.2344 511.6563,219.2344 Q509.1563,219.2344 507.8281,217.5938 Q506.5156,215.9375 506.5156,212.8125 Q506.5156,209.6875 507.8281,208.0313 Q509.1563,206.375 511.6563,206.375 Q512.3594,206.375 513,206.5313 Q513.6563,206.6875 514.2188,206.9844 L514.2188,209.7031 Q513.5938,209.125 513,208.8594 Q512.4063,208.5781 511.7813,208.5781 Q510.4375,208.5781 509.75,209.6563 Q509.0625,210.7188 509.0625,212.8125 Q509.0625,214.9063 509.75,215.9844 Q510.4375,217.0469 511.7813,217.0469 Q512.4063,217.0469 513,216.7813 Q513.5938,216.5 514.2188,215.9219 L514.2188,218.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="41" x="531.75" y="217.1543">routes</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="463" x2="609" y1="229" y2="229"/><ellipse cx="473" cy="240" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="75" x="482" y="243.2104">productRoute</text><ellipse cx="473" cy="252.8047" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="122" x="482" y="256.0151">vendingMachineRoute</text><ellipse cx="473" cy="265.6094" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="57" x="482" y="268.8198">refillRoute</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="463" x2="609" y1="275.4141" y2="275.4141"/><!--MD5=[301f2e77308a9ba28a66bf4bdcec452a]
class controllers--><rect fill="#FEFECE" filter="url(#f4bhnxjssgq2b)" height="48" id="controllers" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="1203.5" y="216"/><ellipse cx="1218.5" cy="232" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1221.4688,237.6406 Q1220.8906,237.9375 1220.25,238.0781 Q1219.6094,238.2344 1218.9063,238.2344 Q1216.4063,238.2344 1215.0781,236.5938 Q1213.7656,234.9375 1213.7656,231.8125 Q1213.7656,228.6875 1215.0781,227.0313 Q1216.4063,225.375 1218.9063,225.375 Q1219.6094,225.375 1220.25,225.5313 Q1220.9063,225.6875 1221.4688,225.9844 L1221.4688,228.7031 Q1220.8438,228.125 1220.25,227.8594 Q1219.6563,227.5781 1219.0313,227.5781 Q1217.6875,227.5781 1217,228.6563 Q1216.3125,229.7188 1216.3125,231.8125 Q1216.3125,233.9063 1217,234.9844 Q1217.6875,236.0469 1219.0313,236.0469 Q1219.6563,236.0469 1220.25,235.7813 Q1220.8438,235.5 1221.4688,234.9219 L1221.4688,237.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="67" x="1232.5" y="236.1543">controllers</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1204.5" x2="1301.5" y1="248" y2="248"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1204.5" x2="1301.5" y1="256" y2="256"/><!--MD5=[753d1b0581c42891df96605679bc06a2]
link VendingMachine to Product--><path d="M485.33,909.07 C489.32,925 494.99,941.69 503,956 C508.38,965.61 515.04,974.91 522.28,983.68 " fill="none" id="VendingMachine-&gt;Product" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="525.87,987.94,523.1085,978.4862,522.6396,984.1236,517.0023,983.6548,525.87,987.94" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="504" y="952.0669">contains (stock.productId)</text><!--MD5=[3e230f8a84b55655154de902aa54116f]
link RefillLog to Product--><path d="M618.31,707.24 C623.43,716.99 628.17,727.08 632,737 C665.04,822.63 665.39,847.71 675,939 C675.79,946.51 677.7,948.94 675,956 C671.62,964.83 666.96,973.34 661.56,981.38 " fill="none" id="RefillLog-&gt;Product" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="658.48,985.79,666.899,980.6793,661.332,981.6832,660.3281,976.1161,658.48,985.79" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="672" y="851.0669">productId (ref)</text><!--MD5=[e01e29094af5e226faafe6992b125461]
link RefillLog to VendingMachine--><path d="M542.31,707.19 C531.17,730.43 518.74,756.35 507.68,779.42 " fill="none" id="RefillLog-&gt;VendingMachine" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="505.48,784,512.9938,777.6327,507.6529,779.4969,505.7888,774.156,505.48,784" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="526" y="750.0669">machineId (ref)</text><!--MD5=[acc7aa8c940477372e5765096033d51c]
link refillController to RefillLog--><path d="M549.33,463.1 C553.4,490.71 559.16,529.69 564.19,563.76 " fill="none" id="refillController-&gt;RefillLog" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="564.92,568.75,567.5688,559.264,564.1929,563.8031,559.6538,560.4273,564.92,568.75" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="557" y="514.0669">create logs</text><!--MD5=[67ebbb6eba23504b24004cc7fc898787]
link refillController to VendingMachine--><path d="M503.22,463.04 C489.3,473.9 473.16,485.04 457,493 C406.99,517.63 369.83,481.7 336,526 C287.17,589.93 305.02,632.76 336,707 C347.51,734.59 367.5,759.49 388.82,780.32 " fill="none" id="refillController-&gt;VendingMachine" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="392.53,783.89,388.8091,774.771,388.9236,780.4267,383.2679,780.5412,392.53,783.89" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="337" y="642.5669">update stock</text><!--MD5=[b18e6fddd49b83de3c9aab6f9d6cceeb]
link index_js to db_js--><path d="M277.8,120.19 C271.1,144.48 261.61,178.84 254.56,204.37 " fill="none" id="index_js-&gt;db_js" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="253.18,209.36,259.4301,201.7484,254.5101,204.5402,251.7183,199.6202,253.18,209.36" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="30" x="270" y="163.0669">uses</text><!--MD5=[2eb8fc21f3fbd4bf8ea946660c7183b3]
link index_js to routes--><path d="M335.69,120.02 C371.41,141.24 420.22,170.22 460.71,194.28 " fill="none" id="index_js-&gt;routes" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="465.1,196.88,459.3893,188.8558,460.7962,194.3349,455.3171,195.7419,465.1,196.88" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="412" y="163.0669">mounts</text><!--MD5=[1172790dc4aa6061888d9a057597c03e]
link routes to vendingMachineController--><path d="M491.49,283.21 C461.18,311.96 421.08,350 390.04,379.44 " fill="none" id="routes-&gt;vendingMachineController" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="386.3,382.98,395.582,379.687,389.9271,379.5385,390.0756,373.8836,386.3,382.98" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[dbbfc0f84d74fcb758e780c2d6c7e7fb]
link routes to refillController--><path d="M537.84,283.21 C539.15,313.4 540.91,353.83 542.21,383.79 " fill="none" id="routes-&gt;refillController" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="542.43,388.88,546.041,379.717,542.2159,383.8846,538.0483,380.0595,542.43,388.88" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f5f8ae98e49ca65979a6350958b2c89f]
link migrateRefillSchema to RefillLog--><path d="M743.97,120.27 C723.93,204.45 666.13,443 637,518 C631.04,533.35 623.64,549.3 616.06,564.34 " fill="none" id="migrateRefillSchema-&gt;RefillLog" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="613.7,568.98,621.3346,562.758,615.9589,564.5194,614.1975,559.1437,613.7,568.98" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="695" y="328.0669">create</text><!--MD5=[ba0e4cda27455b72e5c950717b01b971]
link migrateRefillSchema to VendingMachine--><path d="M755.43,120.01 C759.53,149.92 765,197.57 765,239 C765,239 765,239 765,639 C765,672.99 753.75,682.68 730,707 C697.5,740.29 655.26,767.62 614.6,788.94 " fill="none" id="migrateRefillSchema-&gt;VendingMachine" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="610.16,791.25,619.9914,790.6646,614.6003,788.9513,616.3136,783.5602,610.16,791.25" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="766" y="430.5669">update</text><!--MD5=[f3c5760bc9df125fce65182bb18885ec]
link tests to controllers--><path d="M1106.59,120.19 C1139.83,147.17 1188.42,186.59 1220.36,212.52 " fill="none" id="tests-&gt;controllers" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1224.56,215.92,1220.0937,207.1421,1220.6781,212.7687,1215.0515,213.3531,1224.56,215.92" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="1162" y="163.0669">invoke</text><!--MD5=[263f15eea1a5ca1a92064f49bb04957e]
@startuml
package "Models" {
  class VendingMachine {
    - _id:ObjectId
    - machineCode:string
    - location:string
    - totalSlots:int
    - stock: [{ productId:ObjectId, quantity:int }]
    - updateStock(productId, qtyChange)
  }
  class Product {
    - _id:ObjectId
    - name:string
    - category:string
    - price:number
    - quantity:int
    - machineId:ObjectId
  }
  class RefillLog {
    - _id:ObjectId
    - productId:ObjectId
    - machineId:ObjectId
    - quantityAdded:int
    - refilledBy:string
    - remarks:string
    + post-save hook: increment Product.quantity
  }
}

package "Controllers" {
  class vendingMachineController {
    + getMachines(req,res)
    + getMachineById(req,res)
    + createMachine(req,res)
  }
  class refillController {
    + getRefills(req,res)
    + createRefill(req,res)
  }
}

package "Infra" {
  class index_js {
    + start(): loads dotenv, connectDB(), express app, mount routes, graceful shutdown
  }
  class db_js {
    + connectDB(): validates MONGO_URI, mongoose.connect(uri)
  }
  class migrateRefillSchema {
    + run(): migrate legacy refills -> RefillLog + update machines
  }
  class tests {
    + uses mongodb-memory-server
  }
  class routes {
    + productRoute
    + vendingMachineRoute
    + refillRoute
  }
}

VendingMachine - -> Product : contains (stock.productId)
RefillLog - -> Product : productId (ref)
RefillLog - -> VendingMachine : machineId (ref)
refillController - -> RefillLog : create logs
refillController - -> VendingMachine : update stock
index_js - -> db_js : uses
index_js - -> routes : mounts
routes - -> vendingMachineController
routes - -> refillController
migrateRefillSchema - -> RefillLog : create
migrateRefillSchema - -> VendingMachine : update
tests - -> controllers : invoke
@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.7+6-LTS
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>